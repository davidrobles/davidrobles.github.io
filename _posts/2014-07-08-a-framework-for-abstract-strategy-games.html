---
layout:     post
title:      "An Framework for Abstract Strategy Games"
date:       2014-07-08 16:48:16
comments:   true
excerpt:    "Monte Carlo simulations are a class of computational algorithms
            that involve multiple computational trials driven by random
            sampling to approximate the optimal solution. In this post we
            describe how Monte Carlo simulations work and demo with a
            JavaScript program how to use this method to estimate the value of
            &pi;."
img:        "tic-tac-toe.png"
style:      ["framework-games/styles.css"]
js:         ["lib/jquery-2.1.1.js", "lib/underscore.js", "lib/backbone.js",
             "lib/mauler-0.0.1.js", framework-games/tic-play.js]
---

<div id="toc"></div>

<a name="introduction"></a>

<p>
    In this blog post I'll describe a very basic framework for describing abstract strategy games and algorithms to play
    those games.
</p>

<p>One topic in which I've been very interested and studied for the last few years is games. I think
games are the perfect testbed for Artificial Intelligence. Games provide a perfect framework
with well defined rules and outcomes.</p>


<p>I think that before going to complex games like 3D shooters, we know know to understand games in
their simplest form, which I think are turn-based games (or abstract strategy games). I don't
necessarily refer to games to two players, but also to one player games such as 8-queens.</p>

<p>These are a few games of the types of games that this framework would cover:</p>

<ul>
    <li><a href="http://en.wikipedia.org/wiki/Tic-tac-toe">Tic-Tac-Toe</a></li>
    <li><a href="http://en.wikipedia.org/wiki/Checkers">Checkers</a></li>
    <li><a href="http://en.wikipedia.org/wiki/Chess">Chess</a></li>
    <li><a href="http://en.wikipedia.org/wiki/Reversi">Othello (Reversi)</a></li>
</ul>

<p>The idea of this blog post is to describe a general framework for describing abstract strategy games in a way that
algorithms can be developed to play any kind of game.</p>

<a name="example-tic-tac-toe"></a>
<h2 data-name="example-tic-tac-toe">Example: Tic-Tac-Toe</h2>

<p>In order to describe the framework presented here, we will be using the game of
<a href="http://en.wikipedia.org/wiki/Tic-tac-toe">Tic-Tac-Toe</a> as an example. Tic-Tac-Toe was chosen because is one
of the simplest, yet most popular abstract strategy board games, and most people are familiar with the rules. Here you
can play the game, however, you will be playing against a
<a href="http://en.wikipedia.org/wiki/Solved_game#Perfect_play">perfect player</a>
(<a href="http://en.wikipedia.org/wiki/Alpha%E2%80%93beta_pruning">Alpha-Beta pruning</a>), so the best you can expect
is a draw:</p>

<div id="info-view"></div>

<canvas id="tic-canvas" width="150" height="150">
    Your browser does not support the canvas element.
</canvas>

<button id="restart-button">Restart</button>

<a name="interfaces"></a>
<h2 data-name="interfaces">Interfaces</h2>

<ul>
    <li>Game</li>
    <li>Player</li>
</ul>

<a name="game"></a>
<h2 data-name="game-interface">Game</h2>

<p>
    First of all, what is a game? From the game theoretical point of view a game is a description of strategic
    interaction that includes the constraints on the actions that the players can take and the players’ interests, but
    does not specify the actions that the players do take
    (<a href="http://www.wiley.com/WileyCDA/WileyTitle/productCd-EHEP001009.html">Rasmusen, 2006</a>).
</p>

<p>Knowing that, here we describe an interface that can be used to describe most of these games. Each method is
described in detail later.</p>

<ul>
    
    <li><span class="code" style="font-weight: bold">.copy()</span> Returns a copy of the game.</li>

    <li><span class="code" style="font-weight: bold">.currentPlayer()</span> Returns the player whose turn it is.</li>

    <li>
        <span class="code" style="font-weight: bold">.isOver()</span> Returns true if the game is over, false otherwise.
    </li>

    <li>
        <span class="code" style="font-weight: bold">.move(move)</span> Makes a move for the player whose turn it is.
    </li>

    <li>
        <span class="code" style="font-weight: bold">.moves()</span> Returns an Array of legal moves for the player in
        turn.
    </li>

    <li><span class="code" style="font-weight: bold">.newGame()</span> Returns a new game.</li>

    <li><span class="code" style="font-weight: bold">.outcomes()</span> Returns the outcome for each of player.</li>

    <li><span class="code" style="font-weight: bold">.restart()</span> Restarts the game.</li>
    
</ul>

<hr>

<!-------------------------------------------------------- .copy() ---------------------------------------------------->



<span class="code" style="font-weight: bold">.copy()</span>

<p>Returns a copy of the game.</p>

<strong>Example</strong>

{% highlight javascript %}
var tic = new TicTacToe();
tic.move("5");
tic.move("9");
render(tic);
{% endhighlight %}

<canvas id="moves-board-copy-1" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [[' ', ' ', ' '],
                [' ', 'X', ' '],
                [' ', ' ', 'O']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-copy-1")
    });
}());
</script>

{% highlight javascript %}
var ticCopy = tic.copy();
render(ticCopy);
{% endhighlight %}

<canvas id="moves-board-copy-2" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [[' ', ' ', ' '],
                [' ', 'X', ' '],
                [' ', ' ', 'O']]
    });
    var canvasView = new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-copy-2")
    });
}());
</script>

<hr>

<!---------------------------------------------------- .currentPlayer() ----------------------------------------------->
        
<span class="code" style="font-weight: bold">.currentPlayer()</span>

<p>Returns the player whose turn it is.</p>

<h3>Example</h3>

{% highlight javascript %}
var tic = new TicTacToe();
render(tic);
{% endhighlight %}

<canvas id="moves-board-current-player-1" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe();
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-current-player-1")
    });
}());
</script>

{% highlight javascript %}
tic.currentPlayer();    // "1"
tic.move("5");
render(tic);
{% endhighlight %}

<canvas id="moves-board-current-player-2" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [[' ', ' ', ' '],
                [' ', 'X', ' '],
                [' ', ' ', ' ']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-current-player-2")
    });
}());
</script>

{% highlight javascript %}
tic.currentPlayer();    // "2"
{% endhighlight %}

<hr/>

<!------------------------------------------------------ .isOver() ---------------------------------------------------->
        
<span class="code" style="font-weight: bold">.isOver()</span>

<p>Returns true if the game is over, false otherwise.</p>

<h3>Example</h3>

{% highlight javascript %}
var tic = new TicTacToe();
render(tic);
{% endhighlight %}

<canvas id="moves-board-over-1" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe();
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-over-1")
    });
}());
</script>

{% highlight javascript %}
tic.isOver();     // false
tic.move("5");
tic.move("4");
tic.move("1");
tic.move("9");
tic.move("3");
tic.move("2");
tic.move("7");
render(tic);
{% endhighlight %}

<canvas id="moves-board-over-2" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [['X', 'O', 'X'],
                ['O', 'X', ' '],
                ['X', ' ', 'O']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-over-2")
    });
}());
</script>

{% highlight javascript %}
tic.isOver();    // true
{% endhighlight %}

<hr/>

<!----------------------------------------------------- .move(move) --------------------------------------------------->
        
<span class="code" style="font-weight: bold">.move(move)</span>

<p>Makes a move for the player whose turn it is.</p>

<strong>Example:</strong>
        
{% highlight javascript %}
var tic = new TicTacToe();
render(tic);
{% endhighlight %}

<canvas id="moves-board-move-1" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [[' ', ' ', ' '],
                [' ', ' ', ' '],
                [' ', ' ', ' ']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-move-1")
    });
}());
</script>

{% highlight javascript %}
tic.move("5");
render(tic);
{% endhighlight %}

<canvas id="moves-board-move-2" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [[' ', ' ', ' '],
                [' ', 'X', ' '],
                [' ', ' ', ' ']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-move-2")
    });
}());
</script>

<hr/>

<!------------------------------------------------------- .moves() ---------------------------------------------------->
        
<span class="code" style="font-weight: bold">.moves()</span>

<p>Returns an <span class="code">Array</span> of legal moves for the player in turn.</p>

<strong>Example:</strong>

{% highlight javascript %}
var tic = new TicTacToe();
render(tic);
{% endhighlight %}

<canvas id="moves-board-1" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe();
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-1")
    });
}());
</script>

{% highlight javascript %}
tic.moves();    // ["1", "2", "3", "4", "5", "6", "7", "8", "9"]
tic.move("5");
tic.move("4");
tic.move("1");
render(tic);
{% endhighlight %}

<canvas id="moves-board-some" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [['X', ' ', ' '],
                ['O', 'X', ' '],
                [' ', ' ', ' ']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-some")
    });
}());
</script>

{% highlight javascript %}
tic.moves();    // ["2", "3", "6", "7", "8", "9"]
tic.move("9");
tic.move("3");
tic.move("2");
tic.move("7");
render(tic);
{% endhighlight %}

<canvas id="moves-board-over" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [['X', 'O', 'X'],
                ['O', 'X', ' '],
                ['X', ' ', 'O']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-over")
    });
}());
</script>

{% highlight javascript %}
tic.moves();    // []
{% endhighlight %}

<hr/>

<!------------------------------------------------------ .newGame() --------------------------------------------------->
        
<h3><span class="code" style="font-weight: bold">.newGame()</span></h3>

<p>Returns a new game.</p>

<strong>Example:</strong>

{% highlight javascript %}
var tic = new TicTacToe();
tic.move("5");
tic.move("9");
render(tic);
{% endhighlight %}

<canvas id="moves-new-game-1" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [[' ', ' ', ' '],
                [' ', 'X', ' '],
                [' ', ' ', 'O']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-new-game-1")
    });
}());
</script>

{% highlight javascript %}
var newGame = tic.newGame();
render(newGame);
{% endhighlight %}

<canvas id="moves-new-game-2" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [[' ', ' ', ' '],
                [' ', ' ', ' '],
                [' ', ' ', ' ']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-new-game-2")
    });
}());
</script>

{% highlight javascript %}
render(tic);
{% endhighlight %}

<canvas id="moves-new-game-3" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [[' ', ' ', ' '],
                [' ', 'X', ' '],
                [' ', ' ', 'O']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-new-game-3")
    });
}());
</script>

<hr/>

<!------------------------------------------------------ .outcomes() -------------------------------------------------->
        
<span class="code" style="font-weight: bold">.outcomes()</span>

<p>Returns a dictionary with the outcomes for each of the players.</p>

{% highlight javascript %}
var tic = new TicTacToe();
render(tic);
{% endhighlight %}

<canvas id="moves-board-outcomes-1" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [[' ', ' ', ' '],
                [' ', ' ', ' '],
                [' ', ' ', ' ']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-outcomes-1")
    });
}());
</script>

{% highlight javascript %}
tic.move("5");
tic.move("4");
tic.move("1");
tic.move("9");
tic.move("3");
tic.move("2");
tic.move("7");
render(tic);
{% endhighlight %}

<canvas id="moves-board-outcomes-2" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [['X', 'O', 'X'],
                ['O', 'X', ' '],
                ['X', ' ', 'O']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-outcomes-2")
    });
}());
</script>

{% highlight javascript %}
tic.isOver();      // true
tic.outcomes();    // { "1": "WIN", "2": "LOSS" }
{% endhighlight %}

<hr/>

<!------------------------------------------------------- .restart() -------------------------------------------------->
        
<span class="code" style="font-weight: bold">.restart()</span>

<p>Restarts the game.</p>

<h3>Example</h3>

{% highlight javascript %}
var tic = new TicTacToe();
tic.move("5");
tic.move("9");
render(tic);
{% endhighlight %}

<canvas id="moves-board-restart-1" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe({
        board: [[' ', ' ', ' '],
                [' ', 'X', ' '],
                [' ', ' ', 'O']]
    });
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-restart-1")
    });
}());
</script>

{% highlight javascript %}
tic.restart();
render(tic);
{% endhighlight %}

<canvas id="moves-board-restart-2" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe();
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("moves-board-restart-2")
    });
}());
</script>

<hr/>

### Game

Note: Of course, the efficiency of the game is not the priority, because well, we wouldn't be using
Python in the first place. But for illustrative purposes I think Python is a great prototyping
programming language. All the examples presented here are 

### Players

Players are the individuals who make decisions. A player can be defined as a class that has a
*move()* method that takes that current state of the game and returns the move to take for the
player in turn.

{% highlight python %}
class Player:

    def move(self, game, time_due=0):
        return "Move 1"
{% endhighlight %}

As we can see, we also have an optional "timedue" argument that contains the time the player has to
computation.

For example, we can create a player that makes a random move,

{% highlight python %}
import random

class RandomPlayer:

    def move(self, game, time_due=0):
        return random.choice(game.get_moves())
{% endhighlight %}

## Source Code

The source code used for this blog post is located in a repository in Github of a project that I'm currently working  

Here is a demo written in JavaScript for showing how a Monte Carlo simulation can estimate the value of π. 

You can get the full source code of this blog post on Github.

<a name="play-a-match"></a>
<h2 data-name="play-a-match">Play a Match</h2>

{% highlight javascript %}
var tic = new TicTacToe();
render(tic);
{% endhighlight %}

<canvas id="play-match-1" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe();
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("play-match-1")
    });
}());
</script>

{% highlight javascript %}
var tic = new TicTacToe();
while (!tic.isOver()) {
    var randomMove = Math.floor(Math.random() * this.numMoves());
    tic.move(randomMove);
}
render(tic);
{% endhighlight %}
        
<canvas id="play-match-2" class="small-board">
</canvas>

<script>
(function() {
    var tic = new mauler.games.tic.TicTacToe();
    while (!tic.isOver()) {
        var randomMove = Math.floor(Math.random() * tic.numMoves());
        tic.move(randomMove);
    }
    new mauler.games.tic.CanvasView({
        model: tic,
        width: 100,
        height: 100,
        canvas: document.getElementById("play-match-2")
    });
}());
</script>


<h2>Player</h2>

<h2>Random Player</h2>
        
Also, we can easily create a random player function that is agnostic of the game. As long as the game follows the
interface we described earlier, we can return a random move from the list of <span class="code">.moves()</span>:

{% highlight javascript %}
function randomPlayer(game) {
    return Math.floor(Math.random() * game.moves().length);
}
{% endhighlight %}

Now we can just create a game:

{% highlight javascript %}
var tic = new TicTacToe();
render(tic);
{% endhighlight %}

<canvas id="random-player-1" class="small-board">
</canvas>

<script>
    (function() {
        var tic = new mauler.games.tic.TicTacToe();
        new mauler.games.tic.CanvasView({
            model: tic,
            width: 100,
            height: 100,
            canvas: document.getElementById("random-player-1")
        });
    }());
</script>

<p>And use the random player function to play the game until the end:</p>
        
{% highlight javascript %}
var tic = new TicTacToe();
while (!tic.isOver()) {
    tic.move(randomPlayer(tic));
}
{% endhighlight %}

<canvas id="random-player-2" class="small-board">
</canvas>

<script>
    (function() {
        function randomPlayer(game) {
            return Math.floor(Math.random() * game.moves().length);
        }
        var tic = new mauler.games.tic.TicTacToe();
        while (!tic.isOver()) {
            tic.move(randomPlayer(tic));
        }
        new mauler.games.tic.CanvasView({
            model: tic,
            width: 100,
            height: 100,
            canvas: document.getElementById("random-player-2")
        });
    }());
</script>

<h2>Summary</h2>

<p>
    The framework presented in this blog post is very simple, yet very powerful to have a library of genera game-playing
    algorithms that can be used to play in any game. Evidently, each game will require custom heuristic when used with
    such algorithms, however, the algorithms don't have to change if they are coded in a very abstract way.
</p>

<p>
    Defining a Game Interface like the one before is the base of a game-playing framework and it will be used in
    following blog posts describing game-playing algorithms such as Minimax, Alpha-Beta and Monte-Carlo Tree Search.
</p>
        
<script>
    $(document).ready(function() {
        var h2s = $('.post h2');
        var toc = $('#toc');
        toc.append("<ul>");
        toc.append('<li><a href="#introduction">' + 'Introduction</li>');
        h2s.each(function() { 
            toc.append('<li><a href="#' + $(this).data("name") +'">' + $(this).text() + '</a>');
            var h3s = $(this).find("h3");
            if (h3s.size() > 0) {
                toc.append("<ul>");
                h3s.each(function() {
                    toc.append("<li>" + $(this).text() + "</li>");
                });
                toc.append("</ul>");
            }
            toc.append("</li>");
        });
        toc.append("</ul>");
    });
</script>